<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="description" content="Pol's website. Post-install Raspberry Pi Tweaks"/>

<link rel="icon" type="image/png" sizes="192x192" href="/res/img/favicon192.png">
<link rel="icon" type="image/png" sizes="128x128" href="/res/img/favicon128.png">
<link rel="icon" type="image/png" sizes="64x64" href="/res/img/favicon64.png">
<link rel="shortcut-icon" type="image/png" href="/res/img/favicon64.png">

<link rel="stylesheet" href="/res/css/style.css">
<link rel="styleshet" href="/res/css/foundation-icons.css">

<title>Paolo Scaramuzza | Post-install Raspberry Pi Tweaks</title>
</head>
<body>
<div class="header">
	<div class="headerdata">
		<h1><a class="homelink" href="/">Paolo Scaramuzza</a></h1>
	</div>
	<div class="navbar">
		<a href="/">HOME</a> |
		<a href="/article-index.html">ARTICLES</a> |
		<a href="/random.html">RANDOM STUFF</a> |
		<a href="/now.html">NOW</a> |
		<a href="/about.html">ABOUT</a>
	</div>
</div>

<div id="content" class="content">
	<div id="text" class="tile text">
	<!-- Article text -->
<h1>Post-install Raspberry Pi Tweaks</h1><p>Some notes about the first tweaks I apply on a freshly installed Arch Linux </p><p>image on a Raspberry Pi. The following notes apply to other Linux distros as </p><p>well. Maybe the commands and/or package names are different. </p><p>If, for whatever reason, I'll switch distro (why should I? Arch is the best one) </p><p>I may also update this guide, pointing to the Arch-specific stuff and offeirng </p><p>alternatives. In the meantime, if you stumble upon this page, do your own </p><p>research (DYOR) before blindly applying those tweaks. Moreover, this list is </p><p>highly opinionated DYOR also helps de-opinionate it. Feel free to discuss the </p><p>content by opening an <a href="https://github.com/electricant/electricant.github.io/issues">issue on github</a>. </p><h2>Fakehwclock</h2><p>The raspberry pi does not have and hardware RTC. Therefore, upon reboot the </p><p>time is lost and has to be set manually or via NTP. This process takes time and </p><p>requires an internet connection to be available after boot. </p><p>The utility 'fake-hwclock' <a href="https://archplusplus.co.uk/post/40202081414/fake-hwclock-for-arch-linux-arm-on-raspberry-pi">[1]</a> can be used to restore the clock to an </p><p>approximately accurate value to speed up the NTP clock synchronization </p><p>procedure. </p><p>Fake-hwclock is installed the usual way: </p><pre><code># sudo pacman -Syu fake-hwclock  
 
</code></pre><p>By default the fake-hwclock-save.timer unit is run every 15 minutes and 15m </p><p>after boot. The saving interval is quite short and may damage the SD card in the </p><p>long run. Depending on the time accuracy requirements, by creating an overlay </p><p>file for the unit with the command: </p><pre><code># sudo systemctl edit fake-hwclock-save.timer  
 
</code></pre><p>the interval can be modified. By adding the following lines to the file, the </p><p>timer is run once per day: </p><pre><code>[Timer]  
 
OnUnitActiveSec=1day  
 
AccuracySec=1day  
 
</code></pre><p>The 'AccuracySec' settings is used to save power and avoid waking up the CPU </p><p>just to save the time. Refer to <a href="https://www.freedesktop.org/software/systemd/man/systemd.timer.html">systemd.timer</a> for more details about the various </p><p>timer config options. </p><h2>Use the Hardware Random Number Generator</h2><p>Make sure rng-tools is installed: </p><pre><code># sudo pacman -Syu rng-tools  
 
</code></pre><p>Disable haveged since it is no longer needed and it might compete with rngd </p><pre><code># sudo systemctl disable --now haveged  
 
</code></pre><p>Check that /etc/conf.d/rngd contains the line </p><pre><code>RNGD_OPTS="-o /dev/random -r /dev/hwrng" </code></pre><p>otherwhise add it to the file to tell the daemon where to find the hardware </p><p>random number generator. </p><p>Rngd can now be enabled and started: </p><pre><code># sudo systemctl enable --now rngd  
 
</code></pre><p>You can now check the amount of entropy reported by the kernel: </p><pre><code># cat /proc/sys/kernel/random/entropy_avail </code></pre><p>It should be around 3000 (the more the better). </p><p>sporadic cpu spikes to 100% </p><p>https://wiki.archlinux.org/title/Rng-tools </p><p>Fixed by change config </p><h2>Enable the Watchdog</h2><p>https://wiki.archlinux.org/title/Arch<em>User</em>Repository </p><p>https://aur.archlinux.org/packages/watchdog/ -&gt; add armv6h to the architectures </p><p>in PKGBUILD </p><p>https://raspberrypi.stackexchange.com/questions/92462/installing-watchdog-daemon-on-arch </p><p>[1] <a href="https://archplusplus.co.uk/post/40202081414/fake-hwclock-for-arch-linux-arm-on-raspberry-pi">fake-hwclock for Arch Linux Arm on Raspberry Pi (using systemd)</a> </p>
	</div> <!-- text -->
</div> <!-- content -->
</body>
</html>
<!-- Build timestamp: 2021-09-25T11:53:02.941346+02:00 -->